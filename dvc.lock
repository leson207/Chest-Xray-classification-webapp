schema: '2.0'
stages:
  ingestion:
    cmd: python -m src.Xray.pipeline.ingestion
    deps:
    - path: src/Xray/components/data_ingestion.py
      hash: md5
      md5: 0a29e230b659af604d248225d2e83fe5
      size: 1599
    - path: src/Xray/pipeline/ingestion.py
      hash: md5
      md5: 76516807b366d8d06922bef45197cfaf
      size: 420
    params:
      params.yaml:
        data_ingestion:
          ARTIFACT_DIR: artifacts/data_ingestion
          LOCAL_DIR: artifacts/data_ingestion/data
          DATA_SOURCE: 
            https://drive.google.com/file/d/1pfIAlurfeqFTbirUZ5v_vapIoGPgRiXY/view?usp=sharing
          DATA_FILE_PATH: artifacts/data_ingestion/data.zip
          BUCKET_NAME: leson207
          CLOUD_DIR: data
    outs:
    - path: artifacts/data_ingestion/data
      hash: md5
      md5: 32bf6f51039d304a776f3932ed0348ba.dir
      size: 52165793
      nfiles: 270
    - path: artifacts/data_ingestion/data.zip
      hash: md5
      md5: ab74ecb7417c2c845c565b5b8735f88f
      size: 51277183
  transform:
    cmd: python -m src.Xray.pipeline.transformation
    deps:
    - path: config/config.yaml
      hash: md5
      md5: 9cf43a0184428a7367e9195ea2e50e12
      size: 1577
    - path: src/Xray/components/data_preparation.py
      hash: md5
      md5: b8763ee47270a4697f2ba737ef4c3c1e
      size: 2359
    - path: src/Xray/pipeline/transformation.py
      hash: md5
      md5: b3c3439fe001c2b47c0df1288a3602f7
      size: 332
    params:
      params.yaml:
        data_preparation:
          TRANSFORM:
          TRAIN_DATA_PATH: artifacts/data_ingestion/data/train
          TEST_DATA_PATH: artifacts/data_ingestion/data/test
          BATCH_SIZE: 16
          PIN_MEMORY: true
          ARTIFACT_DIR: artifacts/transform
          TRAIN_TRANSFORM_FILE: artifacts/transform/train_transform.pkl
          TEST_TRANSFORM_FILE: artifacts/transform/test_transform.pkl
        transform:
          BRIGHTNESS: 0.1
          CONTRAST: 0.1
          SATURATION: 0.1
          HUE: 0.1
          RESIZE_SIZE: 224
          CENTERCROP_SIZE: 224
          RANDOM_ROTATION: 10
          NORMALIZE_MEAN:
          - 0.485
          - 0.456
          - 0.406
          NORMALIZE_STD:
          - 0.229
          - 0.224
          - 0.225
    outs:
    - path: artifacts/transform/test_transform.pkl
      hash: md5
      md5: a172468393040d5ac2286409ac5acc4c
      size: 1586
    - path: artifacts/transform/train_transform.pkl
      hash: md5
      md5: ddb2f5d78cfd2dffd5afa0768734efc1
      size: 2230
  training:
    cmd:
    - bentoml list | grep -q 'image_classifier_service' && bentoml delete image_classifier_service
      --yes || echo "Bento 'image_classifier_service' not found. No action taken."
    - bentoml models list | grep -q 'model' && bentoml models delete model --yes ||
      echo "Model 'model' not found. No action taken."
    - python -m src.Xray.pipeline.training
    deps:
    - path: artifacts/data_ingestion/data
      hash: md5
      md5: 32bf6f51039d304a776f3932ed0348ba.dir
      size: 52165793
      nfiles: 270
    - path: artifacts/transform/test_transform.pkl
      hash: md5
      md5: a172468393040d5ac2286409ac5acc4c
      size: 1586
    - path: artifacts/transform/train_transform.pkl
      hash: md5
      md5: ddb2f5d78cfd2dffd5afa0768734efc1
      size: 2230
    - path: src/Xray/components/data_preparation.py
      hash: md5
      md5: b8763ee47270a4697f2ba737ef4c3c1e
      size: 2359
    - path: src/Xray/components/model_preparation.py
      hash: md5
      md5: 1eab1ba158694c047156af3a4b9f08d7
      size: 1972
    - path: src/Xray/components/model_training.py
      hash: md5
      md5: 3cd26297a42a1bc6a09e1abc40a753b2
      size: 2929
    - path: src/Xray/pipeline/training.py
      hash: md5
      md5: 706d2ec50d93f16a4d8e54e3f8d9c215
      size: 1034
    params:
      params.yaml:
        data_preparation:
          TRANSFORM:
          TRAIN_DATA_PATH: artifacts/data_ingestion/data/train
          TEST_DATA_PATH: artifacts/data_ingestion/data/test
          BATCH_SIZE: 16
          PIN_MEMORY: true
          ARTIFACT_DIR: artifacts/transform
          TRAIN_TRANSFORM_FILE: artifacts/transform/train_transform.pkl
          TEST_TRANSFORM_FILE: artifacts/transform/test_transform.pkl
        model:
          NUM_CLASSES: 2
          INPUT_SHAPE:
          - 1
          - 3
          - 224
          - 224
        model_preparation:
          ARGS:
          ARTIFACT_DIR: artifacts/model
          MODEL_PATH: artifacts/model/model.pt
          SCRIPTED_MODEL_PATH: artifacts/model/scripted_model.pt
          STATE_DICT_PATH: artifacts/model/model.pth
    outs:
    - path: artifacts/model/architecture
      hash: md5
      md5: 6d2531988d82f4f1865c2a365dd0e5fe
      size: 1877
    - path: artifacts/model/architecture.png
      hash: md5
      md5: f6539bada03afb9cff7e610dcdf328ae
      size: 20238
    - path: artifacts/model/model.pt
      hash: md5
      md5: 1d62f7a742015ee53b8011cc5f014e90
      size: 1206732
    - path: artifacts/model/model.pth
      hash: md5
      md5: 88eb52a6b6fc76335d330a2115a4b891
      size: 1205708
    - path: artifacts/model/scripted_model.pt
      hash: md5
      md5: 81cda3ec52d0b1528e9b376ce2f043c8
      size: 1209176
  evaluation:
    cmd: python -m src.Xray.pipeline.evaluation
    deps:
    - path: artifacts/data_ingestion/data
      hash: md5
      md5: 32bf6f51039d304a776f3932ed0348ba.dir
      size: 52165793
      nfiles: 270
    - path: artifacts/model/model.pt
      hash: md5
      md5: 1d62f7a742015ee53b8011cc5f014e90
      size: 1206732
    - path: artifacts/model/model.pth
      hash: md5
      md5: 88eb52a6b6fc76335d330a2115a4b891
      size: 1205708
    - path: artifacts/model/scripted_model.pt
      hash: md5
      md5: 81cda3ec52d0b1528e9b376ce2f043c8
      size: 1209176
    - path: artifacts/transform/test_transform.pkl
      hash: md5
      md5: a172468393040d5ac2286409ac5acc4c
      size: 1586
    - path: artifacts/transform/train_transform.pkl
      hash: md5
      md5: ddb2f5d78cfd2dffd5afa0768734efc1
      size: 2230
    - path: config/config.yaml
      hash: md5
      md5: 9cf43a0184428a7367e9195ea2e50e12
      size: 1577
    - path: src/Xray/components/model_evaluation.py
      hash: md5
      md5: 6b3cb1d2b9659d57ae065c50898ad9eb
      size: 1559
    - path: src/Xray/pipeline/evaluation.py
      hash: md5
      md5: 39f0d4371a230172869aff52a55c78f2
      size: 312
    params:
      params.yaml:
        model:
          NUM_CLASSES: 2
          INPUT_SHAPE:
          - 1
          - 3
          - 224
          - 224
        model_evaluation:
          ARGS:
          BATCH_SIZE: 32
          TEST_DATA_DIR: artifacts/data_ingestion/data/test
          TEST_TRANFORM_PATH: artifacts/transform/test_transform.pkl
          MODEL_PATH: artifacts/model/model.pt
          SCRIPTED_MODEL_PATH: artifacts/model/scripted_model.pt
          STATE_DICT_PATH: artifacts/model/model.pth
  transformation:
    cmd: python -m src.Xray.pipeline.transformation
    deps:
    - path: artifacts/data_ingestion/data
      hash: md5
      md5: 32bf6f51039d304a776f3932ed0348ba.dir
      size: 52165793
      nfiles: 270
    - path: src/Xray/components/data_preparation.py
      hash: md5
      md5: b8763ee47270a4697f2ba737ef4c3c1e
      size: 2359
    - path: src/Xray/pipeline/transformation.py
      hash: md5
      md5: b3c3439fe001c2b47c0df1288a3602f7
      size: 332
    params:
      params.yaml:
        data_preparation:
          TRANSFORM:
          TRAIN_DATA_PATH: artifacts/data_ingestion/data/train
          TEST_DATA_PATH: artifacts/data_ingestion/data/test
          BATCH_SIZE: 16
          PIN_MEMORY: true
          ARTIFACT_DIR: artifacts/transform
          TRAIN_TRANSFORM_FILE: artifacts/transform/train_transform.pkl
          TEST_TRANSFORM_FILE: artifacts/transform/test_transform.pkl
        transform:
          BRIGHTNESS: 0.1
          CONTRAST: 0.1
          SATURATION: 0.1
          HUE: 0.1
          RESIZE_SIZE: 224
          CENTERCROP_SIZE: 224
          RANDOM_ROTATION: 10
          NORMALIZE_MEAN:
          - 0.485
          - 0.456
          - 0.406
          NORMALIZE_STD:
          - 0.229
          - 0.224
          - 0.225
    outs:
    - path: artifacts/transform/test_transform.pkl
      hash: md5
      md5: a172468393040d5ac2286409ac5acc4c
      size: 1586
    - path: artifacts/transform/train_transform.pkl
      hash: md5
      md5: ddb2f5d78cfd2dffd5afa0768734efc1
      size: 2230
